;
; I2C_SLAVE(READ).asm
;
; Created: 28-07-2020 01:29:58 PM
; Author : Shri
;

.INCLUDE"M32DEF.INC"

LDI R21, 0xFF
OUT DDRA, R21

CALL I2C_INIT
CALL I2C_LISTEN
CALL I2C_READ
OUT PORTA, R27

HERE:RJMP HERE

I2C_INIT:
LDI R21, 0x10
OUT TWAR, R21
LDI R21, (1<<TWEN)
OUT TWCR, R21
LDI R21, (1<<TWINT) | (1<<TWEN) | (1<<TWEA)
OUT TWCR, R21
RET

I2C_LISTEN:
W1:
IN R21, TWCR
SBRS R21, TWINT
RJMP W1
RET

I2C_READ:
LDI R21, (1<<TWINT) | (1<<TWEN) | (1<<TWEA)
OUT TWCR, R21
W2: IN R21, TWCR
SBRS R21, TWINT
RJMP W2
IN R27, TWDR
RET





 
