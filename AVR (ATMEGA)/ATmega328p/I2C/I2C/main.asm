;
; I2C.asm
;
; Created: 19-07-2020 04:43:58 PM
; Author : Shri
 

 .INCLUDE"M32DEF.INC"

 CALL I2C_INIT
 CALL I2C_START
 LDI R27, 0x40
 CALL I2C_WRITE

 LDI R27, 0x00
 CALL I2C_WRITE
 CBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0x20
 CALL I2C_WRITE
 CBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE


  LDI R27, 0x20
 CALL I2C_WRITE
 CBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0x80
 CALL I2C_WRITE
 CBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE


  LDI R27, 0x00
 CALL I2C_WRITE
 CBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0xC0
 CALL I2C_WRITE
 CBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE


  LDI R27, 0x00
 CALL I2C_WRITE
 CBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0x60
 CALL I2C_WRITE
 CBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE


  LDI R27, 0x30
 CALL I2C_WRITE
 SBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0x50
 CALL I2C_WRITE
 SBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE
 
 LDI R27, 0x30
 CALL I2C_WRITE
 SBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0x60
 CALL I2C_WRITE
 SBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

LDI R27, 0x30
 CALL I2C_WRITE
 SBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0x00
 CALL I2C_WRITE
 SBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0x30
 CALL I2C_WRITE
 SBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0x10
 CALL I2C_WRITE
 SBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0x30
 CALL I2C_WRITE
 SBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE

 LDI R27, 0x20
 CALL I2C_WRITE
 SBR r27, 1
 CALL I2C_WRITE
 SBR r27, 4
 CALL I2C_WRITE
 CBR r27, 4
 CALL I2C_WRITE


  CALL I2C_STOP

 HERE:RJMP HERE

 I2C_INIT:
 LDI R21, 0
 OUT TWSR, R21
 LDI R21, 0x47
 OUT TWBR, R21
 LDI R21, (1<<TWEN)
 OUT TWCR, R21
 RET

 I2C_START:
 LDI R21, (1<<TWINT) | (1<<TWSTA) | (1<<TWEN)
 OUT TWCR, R21

 WAIT1:
 IN R21, TWCR
 SBRS R21, TWINT
 RJMP WAIT1
 RET

 I2C_WRITE:
 OUT TWDR, R27
 LDI R21, (1<<TWINT) | (1<<TWEN)
OUT TWCR,R21

WAIT3:
IN R21, TWCR
SBRS R21, TWINT
RJMP WAIT3
RET

I2C_STOP:
LDI R21, (1<<TWINT) | (1<<TWSTO) | (1<<TWEN)
OUT TWCR, R21
RET
